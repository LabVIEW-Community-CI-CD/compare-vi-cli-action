Deterministic Runs Hand-off – Updated 2025-10-09 @ 00:44 UTC

Context Snapshot
- Branch: `issue/88-dev-dashboard-phase2`
- Issue/PR: #88 (open), PR #100 (open against develop)
- Latest commits on branch: service-safe invoker spawn + git safe.directory (`4d92d99`), UseSingleInvoker guard (`c1a64c3`), fixture manifest cleanup + pair block (`66d2b63`)
- Active workflows (monitor):
  * Validate – run `18361996747` (queued)
  * CI Orchestrated (strategy=single, include_integration=true, sample `ts-20251008-174402-lgv4`) – run `18361999212` (in progress)

Top Priorities for Next Agent
1. Watch the queued Validate run and the orchestrated single run until completion. Capture READY status, artifact summaries, rerun hints, and confirm dispatcher job success.
2. Fix the dispatcher "Append artifact map" failure: update `.github/workflows/ci-orchestrated.yml` (matrix + single sections) to call `tools/Write-ArtifactMap.ps1` with explicit named parameters (`-PathsList` or splatting) to avoid positional binding errors.
3. Re-run orchestrated single after the artifact map fix and ensure dispatcher job exits cleanly.
4. Confirm both Ubuntu and Windows fixture-drift jobs succeed with the refreshed manifest (`fixtures.manifest.json` now contains only one base/head pair plus the deterministic `pair` block). Review `results/fixture-drift/**/drift-summary.json` for `status=ok`.
5. Continue work on #88 once CI is green (traceability matrix coverage, LV closure telemetry crumbs, runbook DX).

Environment Preconditions (set at session start)
- `$env:LV_SUPPRESS_UI = '1'`
- `$env:LV_NO_ACTIVATE = '1'`
- `$env:LV_CURSOR_RESTORE = '1'`
- `$env:LVCI_SINGLE_COMPARE = '1'`
- `$env:LVCI_SINGLE_COMPARE_AUTOSTOP = '1'`
- `$env:LOCAL_DISPATCHER = '1'`
- `$env:SESSION_LOCK_ENABLED = '1'`
- `$env:SESSION_LOCK_STRICT = '1'`
- Optional telemetry: `$env:EMIT_LV_CLOSURE_CRUMBS = '1'`

Recent Changes / What’s Fixed
- Fixture manifest duplicate entry removed; `tools/Validate-Fixtures.ps1 -Json` now returns `exitCode: 0` locally.
- Ensure-Invoker composite now resolves pwsh via `Get-Command`/`$PSHome`, preventing service-context READY failures.
- `$script:UseSingleInvoker` is defaulted to `$false`, so Quick-DispatcherSmoke runs succeed in non-single-invoker mode.

Open Issues / Pending Work
- Dispatcher artifact map step still fails (`Write-ArtifactMap.ps1` positional parameter error). Needs workflow patch + retest.
- Validate & orchestrated CI runs are outstanding – must verify green before new changes merge.
- Fixture drift workflows need re-verification post-manifest fix; prior runs showed `fail-structural` with exitCode 8 (duplicate) and exitCode 5 (untracked/duplicate) – expect clean summaries after rerun.

Useful Commands & Scripts
- Fixture validator: `pwsh -File tools/Validate-Fixtures.ps1 -Json`
- Update manifest with pair: `pwsh -File tools/Update-FixtureManifest.ps1 -Allow -InjectPair -SetExpectedOutcome any -SetEnforce notice`
- Dispatcher quick smoke: `pwsh -File tools/Quick-DispatcherSmoke.ps1 -PreferWorkspace`
- Orchestrated dispatch helper: `pwsh -File tools/Dispatch-WithSample.ps1 ci-orchestrated.yml -Ref issue/88-dev-dashboard-phase2 -IncludeIntegration true -Strategy single`
- Traceability matrix builder: `pwsh -File scripts/Invoke-PesterSingleLoop.ps1 -TraceMatrix -RenderTraceMatrixHtml`
- Workflow monitor: `pwsh -File tools/Track-WorkflowRun.ps1 -RunId <id> -IncludeCheckRuns`

Artifacts & Logs to Review After Runs
- `tests/results/_diagnostics/guard.json` – dispatcher guard crumb (READY status)
- `tests/results/_diagnostics/lv-closure.ndjson` – LV closure telemetry when crumbs enabled
- `tests/results/_trace/trace-matrix.json` & `trace-matrix.html` – ensure schema compliance
- `results/fixture-drift/<timestamp>/drift-summary.json` – verify `status=ok`, no duplicate/untracked categories
- Dispatcher job summary – confirm artifact map step passes once patched

Reference Docs
- `docs/DEV_DASHBOARD_PLAN.md`
- `docs/requirements/WATCH_AND_QUEUE.md`
- `docs/LABVIEW_GATING.md`
- `docs/plans/TRACEABILITY_MATRIX_PLAN.md`
- ADR 0001 and linked requirements (use `tools/New-Adr.ps1`, `tools/Link-RequirementToAdr.ps1` for updates)

Reminder
- Keep commits scoped and reference `#88`.
- Leave CI green before handoff; rerun Validate + orchestrated jobs as needed.
