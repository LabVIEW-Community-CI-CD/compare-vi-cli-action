{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Build CompareVI CLI (Release)",
      "type": "process",
      "command": "dotnet",
      "args": [
        "build",
        "src/CompareVi.Tools.Cli",
        "-c",
        "Release",
        "-nologo"
      ],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "problemMatcher": "$msCompile",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "Handoff: Apply Toggles + Telemetry",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/Print-AgentHandoff.ps1",
        "-ApplyToggles",
        "-AutoTrim"
      ],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "shared" }
    },
    {
      "label": "Build Tools Image (Docker)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/Build-ToolsImage.ps1",
        "-Tag",
        "comparevi-tools:local"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "Run Non-LV Checks (Tools Image)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/Run-NonLVChecksInDocker.ps1",
        "-ToolsImageTag",
        "comparevi-tools:local",
        "-UseToolsImage"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "Run Non-LV Checks (Tools Image, strict)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/Run-NonLVChecksInDocker.ps1",
        "-ToolsImageTag",
        "comparevi-tools:local",
        "-UseToolsImage",
        "-FailOnWorkflowDrift"
      ],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated" }
    },
    {
      "label": "Parse CLI Compare Outcome (.NET)",
      "type": "process",
      "command": "dotnet",
      "args": [
        "run",
        "--project",
        "src/CompareVi.Tools.Cli",
        "--",
        "compare",
        "parse",
        "--search",
        "tests/results/compare-cli",
        "--out",
        "tests/results/compare-cli/compare-outcome.json"
      ],
      "dependsOn": [
        "Build CompareVI CLI (Release)"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "Integration (Standing Priority): Auto Push + Start + Watch",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/Start-IntegrationGated.ps1",
        "-AutoPush",
        "-Start",
        "-Watch"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "Integration (Standing Priority): Watch existing run",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/Start-IntegrationGated.ps1",
        "-Watch"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "CI Watch (REST)",
      "type": "shell",
      "command": "npm",
      "args": [
        "run",
        "ci:watch:rest",
        "--",
        "--run-id",
        "${input:runId}"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "Run Non-LV Checks (Docker)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/Run-NonLVChecksInDocker.ps1"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "Run Non-LV Checks (Docker, strict)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/Run-NonLVChecksInDocker.ps1",
        "-FailOnWorkflowDrift"
      ],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated" }
    },
    {
      "label": "Run Validate Container (CLI smoke)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/Run-ValidateContainer.ps1"
      ],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated" }
    },
    {
      "label": "Run PrePush Checks",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/PrePush-Checks.ps1"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "Run Pester Tests (Unit)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "./Invoke-PesterTests.ps1"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "Run Pester Tests (Integration)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "./Invoke-PesterTests.ps1",
        "-IncludeIntegration",
        "true"
      ],
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    }
  
    ,
    {
      "label": "Standing Priority: Refresh Snapshot",
      "type": "shell",
      "command": "npm",
      "args": ["run","priority:sync"],
      "options": { "cwd": "" },
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "shared" }
    },
    {
      "label": "Standing Priority: Show Router",
      "type": "shell",
      "command": "npm",
      "args": ["run","priority:show"],
      "options": { "cwd": "" },
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "shared" }
    },
    {
      "label": "Standing Priority: Handoff Tests",
      "type": "shell",
      "command": "npm",
      "args": ["run","priority:handoff-tests"],
      "options": { "cwd": "" },
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "shared" }
    },
    {
      "label": "Dispatch Orchestrated (develop, include_integration=true)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/Dispatch-WithSample.ps1",
        "ci-orchestrated.yml",
        "-Ref",
        "develop",
        "-IncludeIntegration",
        "true"
      ],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated" }
    },
    {
      "label": "Follow Orchestrated Run (Docker)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "tools/Follow-OrchestratedRun.ps1",
        "-RunId",
        "${input:runId}",
        "-Watch"
      ],
      "problemMatcher": [],
      "presentation": { "reveal": "always", "panel": "dedicated" }
    },
    {
      "label": "Standing Priority (#127): Quick Local Queue",
      "dependsOrder": "sequence",
      "dependsOn": [
        "Handoff: Apply Toggles + Telemetry",
        "Build Tools Image (Docker)",
        "Run Non-LV Checks (Tools Image, strict)",
        "Run Pester Tests (Unit)"
      ]
    }
 ]
  ,
  "inputs": [
    {
      "id": "runId",
      "type": "promptString",
      "description": "Enter GitHub workflow run id to follow",
      "default": ""
    }
  ]
}
