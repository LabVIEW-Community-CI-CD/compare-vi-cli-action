{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Watch Pester Artifacts (Node)",
      "type": "shell",
      "command": "node",
      "args": [
        "tools/follow-pester-artifacts.mjs",
        "--results",
        "tests/results"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "isBackground": true,
      "problemMatcher": [
        {
          "owner": "pester-hang",
          "severity": "warning",
          "pattern": {
            "regexp": "^\\[hang-watch\\]\\s+(.*)$",
            "message": 1
          }
        },
        {
          "owner": "pester-hang",
          "severity": "error",
          "pattern": {
            "regexp": "^\\[hang-suspect\\]\\s+(.*)$",
            "message": 1
          }
        },
        {
          "owner": "pester-hang",
          "severity": "warning",
          "pattern": {
            "regexp": "^\\[busy-watch\\]\\s+(.*)$",
            "message": 1
          }
        },
        {
          "owner": "pester-hang",
          "severity": "error",
          "pattern": {
            "regexp": "^\\[busy-suspect\\]\\s+(.*)$",
            "message": 1
          }
        }
      ],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      }
    },
    {
      "label": "Watch Pester Artifacts (Node, fail fast)",
      "type": "shell",
      "command": "node",
      "args": [
        "tools/follow-pester-artifacts.mjs",
        "--results",
        "tests/results",
        "--warn-seconds",
        "60",
        "--hang-seconds",
        "120",
        "--poll-ms",
        "2000",
        "--no-progress-seconds",
        "60",
        "--exit-on-hang",
        "--exit-on-no-progress"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [
        {
          "owner": "pester-hang",
          "severity": "warning",
          "pattern": {
            "regexp": "^\\[hang-watch\\]\\s+(.*)$",
            "message": 1
          }
        },
        {
          "owner": "pester-hang",
          "severity": "error",
          "pattern": {
            "regexp": "^\\[hang-suspect\\]\\s+(.*)$",
            "message": 1
          }
        },
        {
          "owner": "pester-hang",
          "severity": "warning",
          "pattern": {
            "regexp": "^\\[busy-watch\\]\\s+(.*)$",
            "message": 1
          }
        },
        {
          "owner": "pester-hang",
          "severity": "error",
          "pattern": {
            "regexp": "^\\[busy-suspect\\]\\s+(.*)$",
            "message": 1
          }
        }
      ],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      }
    },
    {
      "label": "Run Tests (Local)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "./Invoke-PesterTests.ps1",
        "-ResultsPath",
        "tests/results"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": []
    },
    {
      "label": "Watch Pester Artifacts (PS fallback)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "./tools/Follow-PesterArtifacts.ps1",
        "-ResultsDir",
        "tests/results",
        "-WarnSeconds",
        "60",
        "-HangSeconds",
        "120"
      ],
      "isBackground": true,
      "problemMatcher": [
        {
          "owner": "pester-hang",
          "severity": "warning",
          "pattern": {
            "regexp": "^\\[hang-watch\\]\\s+(.*)$",
            "message": 1
          }
        },
        {
          "owner": "pester-hang",
          "severity": "error",
          "pattern": {
            "regexp": "^\\[hang-suspect\\]\\s+(.*)$",
            "message": 1
          }
        },
        {
          "owner": "pester-hang",
          "severity": "warning",
          "pattern": {
            "regexp": "^\\[busy-watch\\]\\s+(.*)$",
            "message": 1
          }
        },
        {
          "owner": "pester-hang",
          "severity": "error",
          "pattern": {
            "regexp": "^\\[busy-suspect\\]\\s+(.*)$",
            "message": 1
          }
        }
      ],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      }
    },
    {
      "label": "Watch Pester Artifacts (PS fallback, fail fast)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoLogo",
        "-NoProfile",
        "-File",
        "./tools/Follow-PesterArtifacts.ps1",
        "-ResultsDir",
        "tests/results",
        "-WarnSeconds",
        "60",
        "-HangSeconds",
        "120",
        "-PollMs",
        "2000",
        "-NoProgressSeconds",
        "60",
        "-ExitOnHang",
        "-ExitOnNoProgress"
      ],
      "problemMatcher": [
        {
          "owner": "pester-hang",
          "severity": "warning",
          "pattern": {
            "regexp": "^\\[hang-watch\\]\\s+(.*)$",
            "message": 1
          }
        },
        {
          "owner": "pester-hang",
          "severity": "error",
          "pattern": {
            "regexp": "^\\[hang-suspect\\]\\s+(.*)$",
            "message": 1
          }
        },
        {
          "owner": "pester-hang",
          "severity": "warning",
          "pattern": {
            "regexp": "^\\[busy-watch\\]\\s+(.*)$",
            "message": 1
          }
        },
        {
          "owner": "pester-hang",
          "severity": "error",
          "pattern": {
            "regexp": "^\\[busy-suspect\\]\\s+(.*)$",
            "message": 1
          }
        }
      ],
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "clear": true
      }
    }
  ]
}